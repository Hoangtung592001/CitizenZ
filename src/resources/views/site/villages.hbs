<table class="table">
<thead>
    <tr>
    <th scope="col">STT</th>
    <th scope="col">Tên Phố, Thôn, Bản</th>
    <th scope="col">Tình trạng nhập liệu</th>
    <th scope="col">Dân số</th>
    </tr>
</thead>
<tbody class="village__table">
    {{#each villages}}
    <tr>
    <th scope="row">{{this.village_id}}</th>
    <td><a href="http://localhost:5000/{{this.village_id}}/citizen" class="link-secondary">{{this.name}}</a></td>
    <td>{{processing this.declaringDone}}</td>
    <td>{{this.population}}</td>
    </tr>
    {{/each}}
</tbody>
</table>
<script src="/socket.io/socket.io.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const villageTable = document.querySelector('.village__table');
        const url = window.location.href.slice(0, 28);
        const socket = io();

        socket.on('chatMessage', ({ msg }) => {
            fetch(url)
                .then(data => data.json())
                .then(villages => {
                    villageTable.innerHTML = villages.map((village) => {
                        return `
                            <tr>
                                <th scope="row">${village.village_id}</th>
                                <td><a href="http://localhost:5000/${this.village_id}/citizen" class="link-secondary">${this.name}</a></td>
                                <td>${village.declaringDone ? 'Nhập liệu thành công!' : 'Đang nhập liệu!'}</td>
                                <td>${village.population}</td>
                            </tr>
                            `
                    }).join('');
                })
        })
    });
</script>
